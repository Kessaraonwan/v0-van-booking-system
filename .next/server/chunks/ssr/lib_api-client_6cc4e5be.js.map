{"version":3,"sources":["../../../../lib/api-client.js"],"sourcesContent":["// API Client for Van Booking System\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8080/api';\n\n// Token management\nexport const getToken = () => {\n  if (typeof window !== 'undefined') {\n    return localStorage.getItem('accessToken');\n  }\n  return null;\n};\n\nexport const setToken = (token) => {\n  if (typeof window !== 'undefined') {\n    localStorage.setItem('accessToken', token);\n  }\n};\n\nexport const getRefreshToken = () => {\n  if (typeof window !== 'undefined') {\n    return localStorage.getItem('refreshToken');\n  }\n  return null;\n};\n\nexport const setRefreshToken = (token) => {\n  if (typeof window !== 'undefined') {\n    localStorage.setItem('refreshToken', token);\n  }\n};\n\nexport const removeTokens = () => {\n  if (typeof window !== 'undefined') {\n    localStorage.removeItem('accessToken');\n    localStorage.removeItem('refreshToken');\n    localStorage.removeItem('user');\n  }\n};\n\nexport const getUser = () => {\n  if (typeof window !== 'undefined') {\n    const user = localStorage.getItem('user');\n    return user ? JSON.parse(user) : null;\n  }\n  return null;\n};\n\nexport const setUser = (user) => {\n  if (typeof window !== 'undefined') {\n    localStorage.setItem('user', JSON.stringify(user));\n  }\n};\n\n// API request helper\nconst apiRequest = async (endpoint, options = {}) => {\n  const token = getToken();\n  \n  const headers = {\n    'Content-Type': 'application/json',\n    ...options.headers,\n  };\n\n  if (token) {\n    headers['Authorization'] = `Bearer ${token}`;\n  }\n\n  const config = {\n    ...options,\n    headers,\n  };\n\n  try {\n    const response = await fetch(`${API_BASE_URL}${endpoint}`, config);\n    const text = await response.text();\n    let data = null;\n    try {\n      data = text ? JSON.parse(text) : null;\n    } catch (e) {\n      // response is not JSON (could be HTML error page or plain text)\n      data = text\n    }\n\n    if (!response.ok) {\n      // Handle token expiration\n      if (response.status === 401 && token) {\n        const refreshed = await refreshAccessToken();\n        if (refreshed) {\n          // Retry request with new token\n          return apiRequest(endpoint, options);\n        } else {\n          removeTokens();\n          window.location.href = '/login';\n        }\n      }\n\n      const message = (data && typeof data === 'object' && data.message) ? data.message : (typeof data === 'string' ? data : 'API request failed');\n      throw new Error(message);\n    }\n\n    return data;\n  } catch (error) {\n    console.error('API Request Error:', error);\n    throw error;\n  }\n};\n\n// Refresh access token\nconst refreshAccessToken = async () => {\n  const refreshToken = getRefreshToken();\n  \n  if (!refreshToken) {\n    return false;\n  }\n\n  try {\n    const response = await fetch(`${API_BASE_URL}/auth/refresh`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ refreshToken }),\n    });\n\n    const text = await response.text();\n    let data = null;\n    try {\n      data = text ? JSON.parse(text) : null;\n    } catch (e) {\n      data = text\n    }\n\n    if (response.ok && data && data.success) {\n      setToken(data.data.accessToken);\n      setRefreshToken(data.data.refreshToken);\n      return true;\n    }\n\n    return false;\n  } catch (error) {\n    console.error('Token refresh error:', error);\n    return false;\n  }\n};\n\n// Auth API\nexport const authAPI = {\n  register: async (userData) => {\n    const data = await apiRequest('/auth/register', {\n      method: 'POST',\n      body: JSON.stringify(userData),\n    });\n    \n    if (data.success) {\n      setToken(data.data.accessToken);\n      setRefreshToken(data.data.refreshToken);\n      setUser(data.data.user);\n    }\n    \n    return data;\n  },\n\n  login: async (credentials) => {\n    const data = await apiRequest('/auth/login', {\n      method: 'POST',\n      body: JSON.stringify(credentials),\n    });\n    \n    if (data.success) {\n      setToken(data.data.accessToken);\n      setRefreshToken(data.data.refreshToken);\n      setUser(data.data.user);\n    }\n    \n    return data;\n  },\n\n  logout: () => {\n    removeTokens();\n  },\n\n  getProfile: async () => {\n    return apiRequest('/auth/me');\n  },\n\n  updateProfile: async (userData) => {\n    return apiRequest('/auth/me', {\n      method: 'PUT',\n      body: JSON.stringify(userData),\n    });\n  },\n\n  changePassword: async (passwords) => {\n    return apiRequest('/auth/change-password', {\n      method: 'POST',\n      body: JSON.stringify(passwords),\n    });\n  },\n};\n\n// Schedule API\nexport const scheduleAPI = {\n  search: async (params) => {\n    const queryString = new URLSearchParams(params).toString();\n    return apiRequest(`/schedules/search?${queryString}`);\n  },\n\n  getById: async (id) => {\n    return apiRequest(`/schedules/${id}`);\n  },\n\n  getSeats: async (id) => {\n    return apiRequest(`/schedules/${id}/seats`);\n  },\n  \n  getAll: async () => {\n    return apiRequest('/schedules');\n  },\n};\n\n// Booking API\nexport const bookingAPI = {\n\n  create: async (bookingData) => {\n    return apiRequest('/bookings', {\n      method: 'POST',\n      body: JSON.stringify(bookingData),\n    });\n  },\n\n  getMyBookings: async (status = 'all') => {\n    const q = status && status !== 'all' ? `?status=${status}` : '';\n    return apiRequest(`/bookings${q}`);\n  },\n\n  getById: async (id) => {\n    return apiRequest(`/bookings/${id}`);\n  },\n\n  cancel: async (id, reason) => {\n    return apiRequest(`/bookings/${id}/cancel`, {\n      method: 'PUT',\n      body: JSON.stringify({ reason }),\n    });\n  },\n};\n\n// Payments API (mock/payment endpoints)\nexport const paymentsAPI = {\n  create: async (paymentData) => {\n    return apiRequest('/payments', {\n      method: 'POST',\n      body: JSON.stringify(paymentData),\n    })\n  },\n\n  getByBookingId: async (bookingId) => {\n    return apiRequest(`/payments/${bookingId}`)\n  }\n}\n\n// Route API\nexport const routeAPI = {\n  getAll: async () => {\n    return apiRequest('/routes');\n  },\n\n  getById: async (id) => {\n    return apiRequest(`/routes/${id}`);\n  },\n\n  getPickupPoints: async (routeId) => {\n    return apiRequest(`/routes/${routeId}/pickup-points`);\n  },\n\n  getDropoffPoints: async (routeId) => {\n    return apiRequest(`/routes/${routeId}/dropoff-points`);\n  },\n};\n\n// Review API\nexport const reviewAPI = {\n  getAll: async (params = {}) => {\n    const qs = new URLSearchParams(params).toString()\n    const suffix = qs ? `?${qs}` : ''\n    return apiRequest(`/reviews${suffix}`)\n  }\n}\n\n// Van API\nexport const vanAPI = {\n  getAll: async () => {\n    return apiRequest('/vans');\n  },\n\n  getById: async (id) => {\n    return apiRequest(`/vans/${id}`);\n  },\n};\n\n// Admin API\nexport const adminAPI = {\n  // Dashboard\n  getDashboardStats: async () => {\n    return apiRequest('/admin/dashboard');\n  },\n  getTodaySchedules: async () => {\n    // kept for compatibility; frontend uses scheduleAPI.search for today schedules\n    return apiRequest('/admin/schedules');\n  },\n\n  getRecentBookings: async (limit = 10) => {\n    // recent bookings are returned inside /admin/dashboard\n    return apiRequest('/admin/dashboard');\n  },\n\n  // Bookings\n  getAllBookings: async (params = {}) => {\n    const queryString = new URLSearchParams(params).toString();\n    return apiRequest(`/admin/bookings?${queryString}`);\n  },\n\n  getBookingDetails: async (id) => {\n    return apiRequest(`/admin/bookings/${id}`);\n  },\n\n  updateBookingStatus: async (id, status) => {\n    return apiRequest(`/admin/bookings/${id}/status`, {\n      method: 'PUT',\n      body: JSON.stringify({ status }),\n    });\n  },\n\n  // Schedules\n  getAllSchedules: async (params = {}) => {\n    const queryString = new URLSearchParams(params).toString();\n    return apiRequest(`/admin/schedules?${queryString}`);\n  },\n\n  createSchedule: async (scheduleData) => {\n    return apiRequest('/admin/schedules', {\n      method: 'POST',\n      body: JSON.stringify(scheduleData),\n    });\n  },\n\n  updateSchedule: async (id, scheduleData) => {\n    return apiRequest(`/admin/schedules/${id}`, {\n      method: 'PUT',\n      body: JSON.stringify(scheduleData),\n    });\n  },\n\n  deleteSchedule: async (id) => {\n    return apiRequest(`/admin/schedules/${id}`, {\n      method: 'DELETE',\n    });\n  },\n\n  // Vans\n  getAllVans: async () => {\n    return apiRequest('/admin/vans');\n  },\n\n  createVan: async (vanData) => {\n    return apiRequest('/admin/vans', {\n      method: 'POST',\n      body: JSON.stringify(vanData),\n    });\n  },\n\n  updateVan: async (id, vanData) => {\n    return apiRequest(`/admin/vans/${id}`, {\n      method: 'PUT',\n      body: JSON.stringify(vanData),\n    });\n  },\n\n  deleteVan: async (id) => {\n    return apiRequest(`/admin/vans/${id}`, {\n      method: 'DELETE',\n    });\n  },\n\n  // Routes\n  getAllRoutes: async () => {\n    return apiRequest('/admin/routes');\n  },\n\n  createRoute: async (routeData) => {\n    return apiRequest('/admin/routes', {\n      method: 'POST',\n      body: JSON.stringify(routeData),\n    });\n  },\n\n  updateRoute: async (id, routeData) => {\n    return apiRequest(`/admin/routes/${id}`, {\n      method: 'PUT',\n      body: JSON.stringify(routeData),\n    });\n  },\n\n  deleteRoute: async (id) => {\n    return apiRequest(`/admin/routes/${id}`, {\n      method: 'DELETE',\n    });\n  },\n};\n\nexport default {\n  authAPI,\n  scheduleAPI,\n  bookingAPI,\n  routeAPI,\n  vanAPI,\n  adminAPI,\n};\n"],"names":[],"mappings":"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"}